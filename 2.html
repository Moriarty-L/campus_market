<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>校园二手街 - 绿色校园集市</title>
    <!-- 引入 Element Plus CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/element-plus/dist/index.css"
    />
    <!-- 引入图标库 -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/@element-plus/icons-vue/dist/index.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Helvetica Neue", Helvetica, "PingFang SC",
          "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif;
      }

      :root {
        --primary-color: #67c23a;
        --bg-start: #eef6ff;
        --bg-end: #f5f7fa;
        --surface: #ffffff;
        --text-color: #303133;
      }

      body {
        background: linear-gradient(
          135deg,
          var(--bg-start) 0%,
          var(--bg-end) 100%
        );
        color: var(--text-color);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* 全局布局 */
      .app-container {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* 顶部导航栏 */
      .header-container {
        background-color: var(--surface);
        box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
        position: sticky;
        top: 0;
        z-index: 1000;
        padding: 12px 0;
      }

      .header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        max-width: 1200px;
        margin: 0 auto;
        padding: 6px 20px;
      }

      .logo {
        display: flex;
        align-items: center;
        font-size: 32px;
        font-weight: 700;
        color: var(--primary-color);
        cursor: pointer;
        transition: transform 0.15s ease;
      }

      .logo:hover {
        transform: translateY(-2px);
      }

      .logo-icon {
        margin-right: 12px;
        font-size: 36px;
        line-height: 1;
      }

      .search-container {
        flex: 1;
        max-width: 600px;
        margin: 0 40px;
      }

      /* 美化 Element 输入框 */
      .search-container .el-input .el-input__inner {
        height: 44px;
        border-radius: 10px;
        padding-left: 14px;
      }

      .user-actions {
        display: flex;
        align-items: center;
      }

      .user-avatar {
        margin-left: 20px;
        cursor: pointer;
      }

      /* 主要内容区 */
      .main-content {
        flex: 1;
        max-width: 1200px;
        width: 100%;
        margin: 20px auto;
        padding: 0 20px;
      }

      /* 首页布局 */
      .home-layout {
        display: flex;
        gap: 20px;
      }

      .sidebar {
        width: 200px;
        flex-shrink: 0;
      }

      .home-main {
        flex: 1;
      }

      /* 商品瀑布流 */
      .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .product-card {
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 18px 0 rgba(0, 0, 0, 0.1);
      }

      .product-image {
        height: 180px;
        object-fit: cover;
        width: 100%;
      }

      .product-price {
        color: #f56c6c;
        font-size: 22px;
        font-weight: bold;
        margin: 10px 0;
      }

      .product-info {
        color: #909399;
        font-size: 14px;
        margin-top: 5px;
      }

      .status-tag {
        position: absolute;
        top: 10px;
        right: 10px;
      }

      /* 商品详情页 */
      .product-detail-container {
        background: white;
        border-radius: 8px;
        padding: 30px;
        box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
      }

      .detail-layout {
        display: flex;
        gap: 40px;
      }

      .product-image-large {
        width: 400px;
        height: 400px;
        object-fit: cover;
        border-radius: 8px;
      }

      .product-info-section {
        flex: 1;
      }

      .product-title {
        font-size: 28px;
        margin-bottom: 20px;
        color: #303133;
      }

      .seller-info {
        display: flex;
        align-items: center;
        margin: 25px 0;
        padding: 20px;
        background-color: #f5f7fa;
        border-radius: 8px;
      }

      .seller-avatar {
        margin-right: 15px;
      }

      .seller-details {
        flex: 1;
      }

      .seller-name {
        font-weight: bold;
        margin-bottom: 5px;
      }

      /* 表单页面 */
      .form-container {
        background: white;
        border-radius: 8px;
        padding: 30px;
        box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
        max-width: 800px;
        margin: 0 auto;
      }

      .form-title {
        font-size: 24px;
        margin-bottom: 30px;
        color: #303133;
        text-align: center;
      }

      /* 个人中心 */
      .dashboard-layout {
        display: flex;
        gap: 30px;
      }

      .dashboard-sidebar {
        width: 220px;
        flex-shrink: 0;
      }

      .dashboard-content {
        flex: 1;
        background: white;
        border-radius: 8px;
        padding: 25px;
        box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
      }

      /* 登录/注册页 */
      .auth-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 80vh;
        background: linear-gradient(
            rgba(255, 255, 255, 0.9),
            rgba(255, 255, 255, 0.9)
          ),
          url("https://images.unsplash.com/photo-1523050854058-8df90110c9f1?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80")
            center/cover no-repeat;
      }

      .auth-card {
        width: 100%;
        max-width: 450px;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 6px 30px rgba(0, 0, 0, 0.1);
        background-color: white;
      }

      .auth-logo {
        text-align: center;
        margin-bottom: 30px;
        color: #67c23a;
      }

      /* 底部页脚 */
      .footer-container {
        background-color: #303133;
        color: white;
        padding: 40px 0 20px;
        margin-top: 40px;
      }

      .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
      }

      .footer-section {
        margin-bottom: 20px;
      }

      .footer-title {
        font-size: 18px;
        margin-bottom: 15px;
        color: #67c23a;
      }

      .footer-links a {
        display: block;
        color: #ddd;
        margin-bottom: 8px;
        text-decoration: none;
        transition: color 0.3s;
      }

      .footer-links a:hover {
        color: #67c23a;
      }

      .copyright {
        text-align: center;
        padding-top: 20px;
        border-top: 1px solid #444;
        color: #aaa;
        font-size: 14px;
        width: 100%;
        margin-top: 20px;
      }

      /* 响应式设计 */
      @media (max-width: 992px) {
        .home-layout {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
        }

        .detail-layout {
          flex-direction: column;
        }

        .product-image-large {
          width: 100%;
          height: auto;
          max-height: 400px;
        }

        .dashboard-layout {
          flex-direction: column;
        }

        .dashboard-sidebar {
          width: 100%;
        }
      }

      @media (max-width: 768px) {
        .header-content {
          flex-wrap: wrap;
        }

        .search-container {
          order: 3;
          margin: 10px 0 0;
          max-width: 100%;
          width: 100%;
        }

        .product-grid {
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        }
      }
    </style>
  </head>
  <body>
    <div id="app" class="app-container">
      <!-- 顶部导航栏 -->
      <header class="header-container">
        <div class="header-content">
          <!-- Logo -->
          <div class="logo">
            <i class="el-icon-s-shop logo-icon"></i>
            <span>校园二手街</span>
          </div>

          <!-- 搜索框 -->
          <div class="search-container">
            <el-input
              placeholder="搜索商品..."
              v-model="searchKeyword"
              @keyup.enter="searchProducts"
              clearable
            >
              <template #append>
                <el-button
                  icon="el-icon-search"
                  @click="searchProducts"
                ></el-button>
              </template>
            </el-input>
          </div>

          <!-- 用户操作区域 -->
          <div class="user-actions">
            <template v-if="!isLoggedIn">
              <el-button type="text" @click="activePage = 'login'"
                >登录</el-button
              >
              <el-divider direction="vertical"></el-divider>
              <el-button type="text" @click="activePage = 'register'"
                >注册</el-button
              >
            </template>
            <template v-else>
              <el-button
                type="primary"
                icon="el-icon-plus"
                @click="activePage = 'publish'"
                >我要发布</el-button
              >
              <el-badge :value="3" class="item" style="margin-left: 20px">
                <el-button
                  icon="el-icon-message"
                  circle
                  @click="showNotifications"
                ></el-button>
              </el-badge>
              <el-dropdown class="user-avatar" @command="handleUserCommand">
                <span class="el-dropdown-link">
                  <el-avatar :size="36" :src="currentUser.avatar"></el-avatar>
                </span>
                <template #dropdown>
                  <el-dropdown-menu>
                    <el-dropdown-item command="profile"
                      >个人中心</el-dropdown-item
                    >
                    <el-dropdown-item command="orders"
                      >我的订单</el-dropdown-item
                    >
                    <el-dropdown-item divided command="logout"
                      >退出登录</el-dropdown-item
                    >
                  </el-dropdown-menu>
                </template>
              </el-dropdown>
            </template>
          </div>
        </div>
      </header>

      <!-- 主要内容区 -->
      <main class="main-content">
        <!-- 首页 -->
        <div v-if="activePage === 'home'" class="home-page">
          <div class="home-layout">
            <!-- 左侧分类菜单 -->
            <aside class="sidebar">
              <el-menu
                default-active="all"
                @select="handleCategorySelect"
                style="border-radius: 8px"
              >
                <el-menu-item index="all">
                  <i class="el-icon-menu"></i>
                  <span>全部商品</span>
                </el-menu-item>
                <el-submenu index="category">
                  <template #title>
                    <i class="el-icon-s-grid"></i>
                    <span>商品分类</span>
                  </template>
                  <el-menu-item
                    v-for="category in categories"
                    :key="category.id"
                    :index="category.id"
                  >
                    {{ category.name }}
                  </el-menu-item>
                </el-submenu>
                <el-menu-item index="recommend">
                  <i class="el-icon-star-on"></i>
                  <span>推荐商品</span>
                </el-menu-item>
                <el-menu-item index="hot">
                  <i class="el-icon-fire"></i>
                  <span>热门商品</span>
                </el-menu-item>
              </el-menu>
            </aside>

            <!-- 右侧主要内容 -->
            <div class="home-main">
              <!-- 轮播图 -->
              <el-carousel
                height="300px"
                style="border-radius: 8px; overflow: hidden"
              >
                <el-carousel-item v-for="item in carouselItems" :key="item.id">
                  <img
                    :src="item.image"
                    :alt="item.title"
                    style="width: 100%; height: 100%; object-fit: cover"
                  />
                  <div
                    style="
                      position: absolute;
                      bottom: 20px;
                      left: 20px;
                      color: white;
                      background-color: rgba(0, 0, 0, 0.5);
                      padding: 10px;
                      border-radius: 4px;
                    "
                  >
                    <h3>{{ item.title }}</h3>
                    <p>{{ item.description }}</p>
                  </div>
                </el-carousel-item>
              </el-carousel>

              <!-- 商品瀑布流 -->
              <h2 style="margin: 30px 0 20px">最新商品</h2>
              <div class="product-grid">
                <el-card
                  v-for="product in filteredProducts"
                  :key="product.id"
                  class="product-card"
                  shadow="hover"
                  @click="viewProductDetail(product.id)"
                >
                  <template #header>
                    <div style="position: relative">
                      <img
                        :src="product.image"
                        class="product-image"
                        :alt="product.name"
                      />
                      <el-tag
                        class="status-tag"
                        :type="product.status === '在售' ? 'success' : 'warning'"
                        size="small"
                      >
                        {{ product.status }}
                      </el-tag>
                    </div>
                  </template>

                  <div>
                    <h4
                      style="
                        overflow: hidden;
                        text-overflow: ellipsis;
                        white-space: nowrap;
                        margin-bottom: 10px;
                      "
                    >
                      {{ product.name }}
                    </h4>
                    <div class="product-price">￥{{ product.price }}</div>
                    <div class="product-info">
                      <div>卖家: {{ product.seller }}</div>
                      <div>发布时间: {{ product.createTime }}</div>
                    </div>
                  </div>
                </el-card>
              </div>
            </div>
          </div>
        </div>

        <!-- 商品详情页 -->
        <div
          v-else-if="activePage === 'product-detail'"
          class="product-detail-page"
        >
          <div class="product-detail-container">
            <div class="detail-layout">
              <!-- 左侧商品图片 -->
              <div>
                <img
                  :src="currentProduct.image"
                  class="product-image-large"
                  :alt="currentProduct.name"
                />
                <div style="margin-top: 15px; display: flex; gap: 10px">
                  <el-image
                    v-for="(img, index) in currentProduct.images"
                    :key="index"
                    :src="img"
                    style="
                      width: 80px;
                      height: 80px;
                      border-radius: 4px;
                      cursor: pointer;
                    "
                    @click="currentProduct.image = img"
                  ></el-image>
                </div>
              </div>

              <!-- 右侧商品信息 -->
              <div class="product-info-section">
                <h1 class="product-title">{{ currentProduct.name }}</h1>
                <div class="product-price" style="font-size: 32px">
                  ￥{{ currentProduct.price }}
                </div>
                <div style="color: #909399; margin: 15px 0; font-size: 14px">
                  <span>浏览量: {{ currentProduct.viewCount }}</span>
                  <el-divider direction="vertical"></el-divider>
                  <span>发布时间: {{ currentProduct.createTime }}</span>
                </div>

                <!-- 卖家信息 -->
                <div class="seller-info">
                  <el-avatar
                    :size="50"
                    :src="currentProduct.sellerAvatar"
                    class="seller-avatar"
                  ></el-avatar>
                  <div class="seller-details">
                    <div class="seller-name">{{ currentProduct.seller }}</div>
                    <div
                      style="
                        display: flex;
                        align-items: center;
                        margin-top: 5px;
                      "
                    >
                      <span style="margin-right: 10px; font-size: 14px"
                        >信誉评分:</span
                      >
                      <el-rate
                        v-model="currentProduct.sellerRating"
                        disabled
                        show-score
                        text-color="#ff9900"
                        score-template="{value}"
                      ></el-rate>
                    </div>
                  </div>
                </div>

                <!-- 商品描述 -->
                <div style="margin: 30px 0">
                  <h3 style="margin-bottom: 15px">商品描述</h3>
                  <div style="line-height: 1.6; color: #606266">
                    {{ currentProduct.description }}
                  </div>
                </div>

                <!-- 操作按钮 -->
                <div style="margin-top: 40px">
                  <el-button
                    type="primary"
                    size="large"
                    icon="el-icon-shopping-cart-full"
                    @click="createOrder"
                  >
                    立即购买
                  </el-button>
                  <el-button
                    size="large"
                    icon="el-icon-chat-dot-round"
                    style="margin-left: 20px"
                    @click="contactSeller"
                  >
                    联系卖家
                  </el-button>
                </div>
              </div>
            </div>

            <!-- 商品评价 -->
            <div style="margin-top: 50px">
              <h3 style="margin-bottom: 25px">卖家历史评价</h3>
              <el-timeline>
                <el-timeline-item
                  v-for="(review, index) in currentProduct.reviews"
                  :key="index"
                  :timestamp="review.time"
                  placement="top"
                >
                  <el-card>
                    <div style="display: flex; justify-content: space-between">
                      <div>
                        <span style="font-weight: bold; margin-right: 15px"
                          >{{ review.buyer }}</span
                        >
                        <el-rate
                          v-model="review.rating"
                          disabled
                          size="small"
                        ></el-rate>
                      </div>
                      <span style="color: #909399; font-size: 14px"
                        >购买商品: {{ review.product }}</span
                      >
                    </div>
                    <p style="margin-top: 10px">{{ review.content }}</p>
                  </el-card>
                </el-timeline-item>
              </el-timeline>
            </div>
          </div>
        </div>

        <!-- 发布商品页 -->
        <div v-else-if="activePage === 'publish'" class="publish-page">
          <div class="form-container">
            <h2 class="form-title">发布商品</h2>
            <el-form
              :model="publishForm"
              :rules="publishRules"
              ref="publishFormRef"
              label-width="100px"
            >
              <el-form-item label="商品名称" prop="name">
                <el-input
                  v-model="publishForm.name"
                  placeholder="请输入商品名称"
                  maxlength="50"
                  show-word-limit
                ></el-input>
              </el-form-item>

              <el-form-item label="商品分类" prop="category">
                <el-select
                  v-model="publishForm.category"
                  placeholder="请选择商品分类"
                  style="width: 100%"
                >
                  <el-option
                    v-for="category in categories"
                    :key="category.id"
                    :label="category.name"
                    :value="category.id"
                  ></el-option>
                </el-select>
              </el-form-item>

              <el-form-item label="交易价格" prop="price">
                <el-input-number
                  v-model="publishForm.price"
                  :min="0"
                  :precision="2"
                  :step="0.1"
                  controls-position="right"
                  style="width: 100%"
                ></el-input-number>
              </el-form-item>

              <el-form-item label="商品图片" prop="images">
                <el-upload
                  action="#"
                  list-type="picture-card"
                  :on-preview="handleImagePreview"
                  :on-remove="handleImageRemove"
                  :on-change="handleImageChange"
                  :auto-upload="false"
                  multiple
                  :limit="5"
                >
                  <i class="el-icon-plus"></i>
                </el-upload>
              </el-form-item>

              <el-form-item label="详细描述" prop="description">
                <el-input
                  type="textarea"
                  v-model="publishForm.description"
                  :rows="6"
                  placeholder="请详细描述商品信息，如新旧程度、使用情况等"
                  maxlength="500"
                  show-word-limit
                ></el-input>
              </el-form-item>

              <el-form-item>
                <el-button
                  type="primary"
                  size="large"
                  @click="submitPublish"
                  style="width: 100%"
                >
                  立即发布
                </el-button>
              </el-form-item>
            </el-form>
          </div>
        </div>

        <!-- 订单确认页 -->
        <div
          v-else-if="activePage === 'order-confirm'"
          class="order-confirm-page"
        >
          <div class="form-container">
            <h2 class="form-title">订单确认</h2>

            <!-- 收货人信息 -->
            <div style="margin-bottom: 30px">
              <h3 style="margin-bottom: 15px">收货人信息</h3>
              <el-card>
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    flex-wrap: wrap;
                  "
                >
                  <div style="margin-bottom: 10px">
                    <span style="color: #909399; margin-right: 10px"
                      >姓名:</span
                    >
                    <span>{{ currentUser.realName }}</span>
                  </div>
                  <div style="margin-bottom: 10px">
                    <span style="color: #909399; margin-right: 10px"
                      >手机号:</span
                    >
                    <span>{{ currentUser.phone }}</span>
                  </div>
                  <div style="margin-bottom: 10px">
                    <span style="color: #909399; margin-right: 10px"
                      >学号:</span
                    >
                    <span>{{ currentUser.studentId }}</span>
                  </div>
                  <el-button type="text" icon="el-icon-edit">修改</el-button>
                </div>
              </el-card>
            </div>

            <!-- 商品清单 -->
            <div style="margin-bottom: 30px">
              <h3 style="margin-bottom: 15px">商品清单</h3>
              <el-table :data="orderItems" style="width: 100%">
                <el-table-column
                  prop="name"
                  label="商品名称"
                  width="300"
                ></el-table-column>
                <el-table-column prop="price" label="单价" width="120">
                  <template #default="scope">
                    ￥{{ scope.row.price }}
                  </template>
                </el-table-column>
                <el-table-column prop="quantity" label="数量" width="100">
                  <template #default="scope">
                    <el-input-number
                      v-model="scope.row.quantity"
                      :min="1"
                      size="small"
                    ></el-input-number>
                  </template>
                </el-table-column>
                <el-table-column label="小计" width="120">
                  <template #default="scope">
                    ￥{{ (scope.row.price * scope.row.quantity).toFixed(2) }}
                  </template>
                </el-table-column>
              </el-table>
            </div>

            <!-- 支付方式 -->
            <div style="margin-bottom: 30px">
              <h3 style="margin-bottom: 15px">支付方式</h3>
              <el-radio-group v-model="paymentMethod" style="width: 100%">
                <el-row :gutter="20">
                  <el-col :span="8">
                    <el-radio
                      label="wechat"
                      border
                      style="width: 100%; padding: 15px"
                    >
                      <i
                        class="el-icon-s-promotion"
                        style="font-size: 24px; color: #67c23a"
                      ></i>
                      <div style="margin-top: 5px">微信支付</div>
                    </el-radio>
                  </el-col>
                  <el-col :span="8">
                    <el-radio
                      label="alipay"
                      border
                      style="width: 100%; padding: 15px"
                    >
                      <i
                        class="el-icon-bank-card"
                        style="font-size: 24px; color: #409eff"
                      ></i>
                      <div style="margin-top: 5px">支付宝</div>
                    </el-radio>
                  </el-col>
                  <el-col :span="8">
                    <el-radio
                      label="campus"
                      border
                      style="width: 100%; padding: 15px"
                    >
                      <i
                        class="el-icon-s-flag"
                        style="font-size: 24px; color: #e6a23c"
                      ></i>
                      <div style="margin-top: 5px">校园卡</div>
                    </el-radio>
                  </el-col>
                </el-row>
              </el-radio-group>
            </div>

            <!-- 提交栏 -->
            <div
              style="
                text-align: right;
                border-top: 1px solid #e4e7ed;
                padding-top: 20px;
              "
            >
              <div style="margin-bottom: 15px">
                <span style="font-size: 16px; margin-right: 10px">总价:</span>
                <span style="font-size: 28px; color: #f56c6c; font-weight: bold"
                  >￥{{ totalPrice.toFixed(2) }}</span
                >
              </div>
              <el-button
                type="primary"
                size="large"
                @click="submitOrder"
                style="padding: 12px 50px"
              >
                提交订单
              </el-button>
            </div>
          </div>
        </div>

        <!-- 个人中心 -->
        <div v-else-if="activePage === 'profile'" class="profile-page">
          <div class="dashboard-layout">
            <!-- 左侧菜单 -->
            <div class="dashboard-sidebar">
              <el-menu
                :default-active="profileMenu"
                @select="handleProfileMenuSelect"
                style="border-radius: 8px"
              >
                <el-menu-item index="info">
                  <i class="el-icon-user"></i>
                  <span>个人资料</span>
                </el-menu-item>
                <el-menu-item index="my-products">
                  <i class="el-icon-goods"></i>
                  <span>我发布的商品</span>
                </el-menu-item>
                <el-menu-item index="sold-orders">
                  <i class="el-icon-sold-out"></i>
                  <span>我卖出的订单</span>
                </el-menu-item>
                <el-menu-item index="bought-orders">
                  <i class="el-icon-shopping-cart-full"></i>
                  <span>我买到的宝贝</span>
                </el-menu-item>
              </el-menu>
            </div>

            <!-- 右侧内容区 -->
            <div class="dashboard-content">
              <!-- 个人资料 -->
              <div v-if="profileMenu === 'info'">
                <h2 style="margin-bottom: 25px">个人资料</h2>
                <el-form
                  :model="userInfoForm"
                  label-width="100px"
                  style="max-width: 500px"
                >
                  <el-form-item label="用户名">
                    <el-input
                      v-model="userInfoForm.username"
                      disabled
                    ></el-input>
                  </el-form-item>
                  <el-form-item label="真实姓名">
                    <el-input v-model="userInfoForm.realName"></el-input>
                  </el-form-item>
                  <el-form-item label="手机号">
                    <el-input v-model="userInfoForm.phone"></el-input>
                  </el-form-item>
                  <el-form-item label="学号">
                    <el-input v-model="userInfoForm.studentId"></el-input>
                  </el-form-item>
                  <el-form-item label="修改密码">
                    <el-button type="text" @click="showChangePassword = true"
                      >点击修改密码</el-button
                    >
                  </el-form-item>
                  <el-form-item>
                    <el-button type="primary" @click="updateUserInfo"
                      >保存修改</el-button
                    >
                  </el-form-item>
                </el-form>
              </div>

              <!-- 我发布的商品 -->
              <div v-else-if="profileMenu === 'my-products'">
                <h2 style="margin-bottom: 25px">我发布的商品</h2>
                <el-table :data="myProducts" style="width: 100%">
                  <el-table-column
                    prop="name"
                    label="商品名称"
                    width="250"
                  ></el-table-column>
                  <el-table-column
                    prop="category"
                    label="分类"
                    width="100"
                  ></el-table-column>
                  <el-table-column prop="price" label="价格" width="120">
                    <template #default="scope">
                      ￥{{ scope.row.price }}
                    </template>
                  </el-table-column>
                  <el-table-column prop="status" label="状态" width="100">
                    <template #default="scope">
                      <el-tag
                        :type="scope.row.status === '在售' ? 'success' : 'info'"
                        size="small"
                      >
                        {{ scope.row.status }}
                      </el-tag>
                    </template>
                  </el-table-column>
                  <el-table-column
                    prop="createTime"
                    label="发布时间"
                    width="150"
                  ></el-table-column>
                  <el-table-column label="操作" width="200">
                    <template #default="scope">
                      <el-button size="small" @click="editProduct(scope.row)"
                        >编辑</el-button
                      >
                      <el-button
                        size="small"
                        :type="scope.row.status === '在售' ? 'warning' : 'success'"
                        @click="toggleProductStatus(scope.row)"
                      >
                        {{ scope.row.status === '在售' ? '下架' : '上架' }}
                      </el-button>
                      <el-button
                        size="small"
                        type="danger"
                        @click="deleteProduct(scope.row)"
                        >删除</el-button
                      >
                    </template>
                  </el-table-column>
                </el-table>
              </div>

              <!-- 我买到的宝贝 -->
              <div v-else-if="profileMenu === 'bought-orders'">
                <h2 style="margin-bottom: 25px">我买到的宝贝</h2>
                <div style="margin-bottom: 20px">
                  <el-radio-group v-model="orderFilter" @change="filterOrders">
                    <el-radio-button label="全部"></el-radio-button>
                    <el-radio-button label="待确认"></el-radio-button>
                    <el-radio-button label="交易中"></el-radio-button>
                    <el-radio-button label="已完成"></el-radio-button>
                  </el-radio-group>
                </div>
                <el-table :data="filteredOrders" style="width: 100%">
                  <el-table-column
                    prop="productName"
                    label="商品名称"
                    width="250"
                  ></el-table-column>
                  <el-table-column prop="price" label="价格" width="120">
                    <template #default="scope">
                      ￥{{ scope.row.price }}
                    </template>
                  </el-table-column>
                  <el-table-column prop="status" label="状态" width="100">
                    <template #default="scope">
                      <el-tag
                        :type="getOrderStatusType(scope.row.status)"
                        size="small"
                      >
                        {{ scope.row.status }}
                      </el-tag>
                    </template>
                  </el-table-column>
                  <el-table-column
                    prop="createTime"
                    label="下单时间"
                    width="150"
                  ></el-table-column>
                  <el-table-column label="操作" width="150">
                    <template #default="scope">
                      <el-button
                        v-if="scope.row.status === '已完成'"
                        size="small"
                        type="primary"
                        @click="showReviewDialog(scope.row)"
                      >
                        去评价
                      </el-button>
                      <span v-else style="color: #909399">暂无操作</span>
                    </template>
                  </el-table-column>
                </el-table>
              </div>

              <!-- 我卖出的订单 -->
              <div v-else-if="profileMenu === 'sold-orders'">
                <h2 style="margin-bottom: 25px">我卖出的订单</h2>
                <el-table :data="soldOrders" style="width: 100%">
                  <el-table-column
                    prop="productName"
                    label="商品名称"
                    width="250"
                  ></el-table-column>
                  <el-table-column
                    prop="buyer"
                    label="买家"
                    width="120"
                  ></el-table-column>
                  <el-table-column prop="price" label="价格" width="120">
                    <template #default="scope">
                      ￥{{ scope.row.price }}
                    </template>
                  </el-table-column>
                  <el-table-column prop="status" label="状态" width="100">
                    <template #default="scope">
                      <el-tag
                        :type="getOrderStatusType(scope.row.status)"
                        size="small"
                      >
                        {{ scope.row.status }}
                      </el-tag>
                    </template>
                  </el-table-column>
                  <el-table-column
                    prop="createTime"
                    label="交易时间"
                    width="150"
                  ></el-table-column>
                </el-table>
              </div>
            </div>
          </div>
        </div>

        <!-- 登录页 -->
        <div v-else-if="activePage === 'login'" class="auth-container">
          <div class="auth-card">
            <div class="auth-logo">
              <i class="el-icon-s-shop" style="font-size: 48px"></i>
              <h2 style="margin-top: 10px">校园二手街</h2>
            </div>
            <el-form :model="loginForm" :rules="loginRules" ref="loginFormRef">
              <el-form-item prop="username">
                <el-input
                  v-model="loginForm.username"
                  placeholder="用户名"
                  size="large"
                  prefix-icon="el-icon-user"
                ></el-input>
              </el-form-item>
              <el-form-item prop="password">
                <el-input
                  v-model="loginForm.password"
                  type="password"
                  placeholder="密码"
                  size="large"
                  prefix-icon="el-icon-lock"
                  show-password
                ></el-input>
              </el-form-item>
              <el-form-item>
                <el-button
                  type="primary"
                  style="width: 100%"
                  size="large"
                  @click="handleLogin"
                >
                  登录
                </el-button>
              </el-form-item>
              <div style="text-align: center; margin-top: 20px">
                <span style="color: #909399">还没有账号？</span>
                <el-button type="text" @click="activePage = 'register'"
                  >立即注册</el-button
                >
              </div>
            </el-form>
          </div>
        </div>

        <!-- 注册页 -->
        <div v-else-if="activePage === 'register'" class="auth-container">
          <div class="auth-card">
            <div class="auth-logo">
              <i class="el-icon-s-shop" style="font-size: 48px"></i>
              <h2 style="margin-top: 10px">用户注册</h2>
            </div>
            <el-form
              :model="registerForm"
              :rules="registerRules"
              ref="registerFormRef"
            >
              <el-form-item prop="username">
                <el-input
                  v-model="registerForm.username"
                  placeholder="用户名"
                  size="large"
                  prefix-icon="el-icon-user"
                ></el-input>
              </el-form-item>
              <el-form-item prop="password">
                <el-input
                  v-model="registerForm.password"
                  type="password"
                  placeholder="密码"
                  size="large"
                  prefix-icon="el-icon-lock"
                  show-password
                ></el-input>
              </el-form-item>
              <el-form-item prop="realName">
                <el-input
                  v-model="registerForm.realName"
                  placeholder="真实姓名"
                  size="large"
                  prefix-icon="el-icon-s-custom"
                ></el-input>
              </el-form-item>
              <el-form-item prop="phone">
                <el-input
                  v-model="registerForm.phone"
                  placeholder="手机号"
                  size="large"
                  prefix-icon="el-icon-phone"
                ></el-input>
              </el-form-item>
              <el-form-item prop="studentId">
                <el-input
                  v-model="registerForm.studentId"
                  placeholder="学号"
                  size="large"
                  prefix-icon="el-icon-s-claim"
                ></el-input>
              </el-form-item>
              <el-form-item>
                <el-button
                  type="primary"
                  style="width: 100%"
                  size="large"
                  @click="handleRegister"
                >
                  注册
                </el-button>
              </el-form-item>
              <div style="text-align: center; margin-top: 20px">
                <span style="color: #909399">已有账号？</span>
                <el-button type="text" @click="activePage = 'login'"
                  >立即登录</el-button
                >
              </div>
            </el-form>
          </div>
        </div>
      </main>

      <!-- 底部页脚 -->
      <footer class="footer-container">
        <div class="footer-content">
          <div class="footer-section">
            <h3 class="footer-title">校园二手街</h3>
            <div class="footer-links">
              <a href="#">关于我们</a>
              <a href="#">联系我们</a>
              <a href="#">加入我们</a>
              <a href="#">帮助中心</a>
            </div>
          </div>
          <div class="footer-section">
            <h3 class="footer-title">交易指南</h3>
            <div class="footer-links">
              <a href="#">买家指南</a>
              <a href="#">卖家指南</a>
              <a href="#">交易规则</a>
              <a href="#">安全提示</a>
            </div>
          </div>
          <div class="footer-section">
            <h3 class="footer-title">服务支持</h3>
            <div class="footer-links">
              <a href="#">常见问题</a>
              <a href="#">客服咨询</a>
              <a href="#">投诉建议</a>
              <a href="#">校园合作</a>
            </div>
          </div>
          <div class="footer-section">
            <h3 class="footer-title">关注我们</h3>
            <div class="footer-links">
              <a href="#">微信公众号</a>
              <a href="#">官方微博</a>
              <a href="#">校园论坛</a>
              <a href="#">抖音号</a>
            </div>
          </div>
          <div class="copyright">
            <p>
              © 2023 校园二手街 版权所有 |
              致力于打造绿色、安全、便捷的校园二手交易平台
            </p>
            <p>校园服务热线：400-123-4567 | 邮箱：service@campusmarket.com</p>
          </div>
        </div>
      </footer>

      <!-- 修改密码对话框 -->
      <el-dialog title="修改密码" v-model="showChangePassword" width="400px">
        <el-form
          :model="passwordForm"
          :rules="passwordRules"
          ref="passwordFormRef"
          label-width="80px"
        >
          <el-form-item label="原密码" prop="oldPassword">
            <el-input
              v-model="passwordForm.oldPassword"
              type="password"
            ></el-input>
          </el-form-item>
          <el-form-item label="新密码" prop="newPassword">
            <el-input
              v-model="passwordForm.newPassword"
              type="password"
            ></el-input>
          </el-form-item>
          <el-form-item label="确认密码" prop="confirmPassword">
            <el-input
              v-model="passwordForm.confirmPassword"
              type="password"
            ></el-input>
          </el-form-item>
        </el-form>
        <template #footer>
          <el-button @click="showChangePassword = false">取消</el-button>
          <el-button type="primary" @click="changePassword">确认修改</el-button>
        </template>
      </el-dialog>

      <!-- 评价对话框 -->
      <el-dialog
        title="评价卖家"
        v-model="showReviewDialogVisible"
        width="500px"
      >
        <el-form :model="reviewForm" label-width="80px">
          <el-form-item label="评分">
            <el-rate
              v-model="reviewForm.rating"
              show-text
              :texts="['很差', '差', '一般', '好', '很好']"
            ></el-rate>
          </el-form-item>
          <el-form-item label="评价内容">
            <el-input
              type="textarea"
              v-model="reviewForm.content"
              :rows="4"
              placeholder="请写下您的评价，帮助其他同学了解这位卖家"
              maxlength="200"
              show-word-limit
            ></el-input>
          </el-form-item>
        </el-form>
        <template #footer>
          <el-button @click="showReviewDialogVisible = false">取消</el-button>
          <el-button type="primary" @click="submitReview">提交评价</el-button>
        </template>
      </el-dialog>

      <!-- 图片预览对话框 -->
      <el-dialog v-model="imagePreviewVisible" width="70%">
        <img :src="previewImageUrl" style="width: 100%" alt="预览图片" />
      </el-dialog>
    </div>

    <!-- 引入 Vue 3 和 Element Plus -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script>
      const { createApp, ref, reactive, computed, onMounted } = Vue;
      const { ElMessage, ElMessageBox } = ElementPlus;

      createApp({
        setup() {
          // 当前激活的页面
          const activePage = ref("home");

          // 搜索关键词
          const searchKeyword = ref("");

          // 用户登录状态
          const isLoggedIn = ref(false);

          // 当前用户信息
          const currentUser = ref({
            id: 1,
            username: "campus_user",
            realName: "张同学",
            phone: "13800138000",
            studentId: "20230001",
            avatar:
              "https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",
          });

          // 商品分类
          const categories = ref([
            { id: 1, name: "图书教材" },
            { id: 2, name: "电子产品" },
            { id: 3, name: "生活用品" },
            { id: 4, name: "服饰鞋包" },
            { id: 5, name: "运动器材" },
            { id: 6, name: "美妆个护" },
            { id: 7, name: "其他商品" },
          ]);

          // 轮播图数据
          const carouselItems = ref([
            {
              id: 1,
              title: "新学期教材特惠",
              description: "二手教材低至3折，新学期必备",
              image: "https://img95.699pic.com/photo/50111/9955.jpg_wh300.jpg",
            },
            {
              id: 2,
              title: "环保校园·绿色交易",
              description: "闲置物品循环利用，共建绿色校园",
              image:
                "https://images.unsplash.com/photo-1562774053-701939374585?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
            },
            {
              id: 3,
              title: "毕业季大甩卖",
              description: "毕业生离校，各类物品超值出售",
              image:
                "https://images.unsplash.com/photo-1523580494863-6f3031224c94?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
            },
          ]);

          // 商品数据
          const products = ref([
            {
              id: 1,
              name: "高等数学上册（第7版）",
              price: 25.0,
              image:
                "https://tse3-mm.cn.bing.net/th/id/OIP-C.tM5iDLjuVtWn24Fz2U5FZQAAAA?w=195&h=194&c=7&r=0&o=7&cb=ucfimg2&dpr=1.9&pid=1.7&rm=3&ucfimg=1",
              seller: "张学长",
              sellerAvatar:
                "https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",
              category: 1,
              createTime: "2023-09-10",
              status: "在售",
              description:
                "高等数学上册，第7版，同济大学数学系编。书内有一些笔记，但不影响阅读。",
              viewCount: 125,
              sellerRating: 4.7,
              images: [
                "https://tse3-mm.cn.bing.net/th/id/OIP-C.tM5iDLjuVtWn24Fz2U5FZQAAAA?w=195&h=194&c=7&r=0&o=7&cb=ucfimg2&dpr=1.9&pid=1.7&rm=3&ucfimg=1",
                "https://tse4-mm.cn.bing.net/th/id/OIP-C.cVNsiaTyrWsTjYuwSiatAwAAAA?w=194&h=194&c=7&r=0&o=7&cb=ucfimg2&dpr=1.9&pid=1.7&rm=3&ucfimg=1",
              ],
              reviews: [
                {
                  buyer: "李同学",
                  rating: 5,
                  content: "书很新，卖家很靠谱，交易非常顺利！",
                  time: "2023-08-15",
                  product: "线性代数",
                },
                {
                  buyer: "王同学",
                  rating: 4,
                  content: "书有一些笔记，不过价格实惠，值得购买。",
                  time: "2023-07-22",
                  product: "大学物理",
                },
              ],
            },
            {
              id: 2,
              name: "苹果无线耳机 AirPods Pro",
              price: 899.0,
              image:
                "https://tse2-mm.cn.bing.net/th/id/OIP-C.rkjnDChrId438kVMUyxVbAHaHa?w=170&h=180&c=7&r=0&o=7&cb=ucfimg2&dpr=1.9&pid=1.7&rm=3&ucfimg=1",
              seller: "李学姐",
              sellerAvatar:
                "https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",
              category: 2,
              createTime: "2023-09-12",
              status: "在售",
              description: "AirPods Pro，使用一年，功能完好，配件齐全。",
              viewCount: 89,
              sellerRating: 4.9,
            },
            {
              id: 3,
              name: "台灯（可调光）",
              price: 35.0,
              image:
                "https://images.unsplash.com/photo-1507473885765-e6ed057f782c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
              seller: "王同学",
              sellerAvatar:
                "https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",
              category: 3,
              createTime: "2023-09-05",
              status: "交易中",
              description: "宿舍用台灯，三档调光，使用半年。",
              viewCount: 67,
              sellerRating: 4.5,
            },
            {
              id: 4,
              name: "大学英语四级词汇书",
              price: 15.0,
              image:
                "https://images.unsplash.com/photo-1541963463532-d68292c34b19?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
              seller: "赵学长",
              sellerAvatar:
                "https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",
              category: 1,
              createTime: "2023-09-08",
              status: "在售",
              description: "四级词汇书，几乎全新，帮助通过四级考试。",
              viewCount: 42,
              sellerRating: 4.8,
            },
            {
              id: 5,
              name: "篮球",
              price: 60.0,
              image:
                "https://images.unsplash.com/photo-1546519638-68e109498ffc?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
              seller: "孙同学",
              sellerAvatar:
                "https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",
              category: 5,
              createTime: "2023-09-03",
              status: "在售",
              description: "标准7号篮球，使用一个学期，气足。",
              viewCount: 56,
              sellerRating: 4.6,
            },
            {
              id: 6,
              name: "笔记本电脑支架",
              price: 45.0,
              image:
                "https://tse4-mm.cn.bing.net/th/id/OIP-C.VTeATMziwUCDMPllPi654wHaHa?w=206&h=206&c=7&r=0&o=7&cb=ucfimg2&dpr=1.9&pid=1.7&rm=3&ucfimg=1",
              seller: "周学姐",
              sellerAvatar:
                "https://tse4-mm.cn.bing.net/th/id/OIP-C.VTeATMziwUCDMPllPi654wHaHa?w=206&h=206&c=7&r=0&o=7&cb=ucfimg2&dpr=1.9&pid=1.7&rm=3&ucfimg=1",
              category: 2,
              createTime: "2023-09-11",
              status: "在售",
              description: "铝合金笔记本支架，可调节高度，保护颈椎。",
              viewCount: 31,
              sellerRating: 4.9,
            },
          ]);

          // 当前查看的商品
          const currentProduct = ref({});

          // 发布商品表单
          const publishForm = reactive({
            name: "",
            category: "",
            price: 0,
            images: [],
            description: "",
          });

          // 发布表单验证规则
          const publishRules = {
            name: [
              { required: true, message: "请输入商品名称", trigger: "blur" },
              {
                min: 2,
                max: 50,
                message: "长度在 2 到 50 个字符",
                trigger: "blur",
              },
            ],
            category: [
              { required: true, message: "请选择商品分类", trigger: "change" },
            ],
            price: [
              { required: true, message: "请输入价格", trigger: "blur" },
              {
                type: "number",
                min: 0,
                message: "价格必须大于0",
                trigger: "blur",
              },
            ],
            description: [
              { required: true, message: "请输入商品描述", trigger: "blur" },
            ],
          };

          // 订单项目
          const orderItems = ref([
            { id: 1, name: "高等数学上册（第7版）", price: 25.0, quantity: 1 },
          ]);

          // 支付方式
          const paymentMethod = ref("wechat");

          // 个人中心菜单
          const profileMenu = ref("info");

          // 我的商品
          const myProducts = ref([
            {
              id: 7,
              name: "Java编程思想",
              category: "图书教材",
              price: 40.0,
              status: "在售",
              createTime: "2023-08-20",
            },
            {
              id: 8,
              name: "耳机",
              category: "电子产品",
              price: 120.0,
              status: "下架",
              createTime: "2023-08-15",
            },
          ]);

          // 订单数据
          const orders = ref([
            {
              id: 1,
              productName: "高等数学上册（第7版）",
              price: 25.0,
              status: "已完成",
              createTime: "2023-09-01",
              seller: "张学长",
            },
            {
              id: 2,
              productName: "台灯（可调光）",
              price: 35.0,
              status: "交易中",
              createTime: "2023-09-05",
              seller: "王同学",
            },
            {
              id: 3,
              productName: "篮球",
              price: 60.0,
              status: "待确认",
              createTime: "2023-09-10",
              seller: "孙同学",
            },
          ]);

          // 卖出的订单
          const soldOrders = ref([
            {
              id: 4,
              productName: "Java编程思想",
              price: 40.0,
              status: "已完成",
              createTime: "2023-08-25",
              buyer: "刘同学",
            },
          ]);

          // 订单筛选
          const orderFilter = ref("全部");

          // 用户信息表单
          const userInfoForm = reactive({
            username: "campus_user",
            realName: "张同学",
            phone: "13800138000",
            studentId: "20230001",
          });

          // 修改密码表单
          const passwordForm = reactive({
            oldPassword: "",
            newPassword: "",
            confirmPassword: "",
          });

          // 修改密码验证规则
          const passwordRules = {
            oldPassword: [
              { required: true, message: "请输入原密码", trigger: "blur" },
            ],
            newPassword: [
              { required: true, message: "请输入新密码", trigger: "blur" },
              {
                min: 6,
                max: 20,
                message: "长度在 6 到 20 个字符",
                trigger: "blur",
              },
            ],
            confirmPassword: [
              { required: true, message: "请确认新密码", trigger: "blur" },
              {
                validator: (rule, value, callback) => {
                  if (value !== passwordForm.newPassword) {
                    callback(new Error("两次输入密码不一致!"));
                  } else {
                    callback();
                  }
                },
                trigger: "blur",
              },
            ],
          };

          // 登录表单
          const loginForm = reactive({
            username: "",
            password: "",
          });

          // 登录验证规则
          const loginRules = {
            username: [
              { required: true, message: "请输入用户名", trigger: "blur" },
            ],
            password: [
              { required: true, message: "请输入密码", trigger: "blur" },
            ],
          };

          // 注册表单
          const registerForm = reactive({
            username: "",
            password: "",
            realName: "",
            phone: "",
            studentId: "",
          });

          // 注册验证规则
          const registerRules = {
            username: [
              { required: true, message: "请输入用户名", trigger: "blur" },
              {
                min: 3,
                max: 20,
                message: "长度在 3 到 20 个字符",
                trigger: "blur",
              },
            ],
            password: [
              { required: true, message: "请输入密码", trigger: "blur" },
              {
                min: 6,
                max: 20,
                message: "长度在 6 到 20 个字符",
                trigger: "blur",
              },
            ],
            realName: [
              { required: true, message: "请输入真实姓名", trigger: "blur" },
            ],
            phone: [
              { required: true, message: "请输入手机号", trigger: "blur" },
              {
                pattern: /^1[3-9]\d{9}$/,
                message: "请输入正确的手机号",
                trigger: "blur",
              },
            ],
            studentId: [
              { required: true, message: "请输入学号", trigger: "blur" },
            ],
          };

          // 评价表单
          const reviewForm = reactive({
            rating: 5,
            content: "",
          });

          // 对话框显示状态
          const showChangePassword = ref(false);
          const showReviewDialogVisible = ref(false);
          const imagePreviewVisible = ref(false);
          const previewImageUrl = ref("");

          // 表单引用
          const publishFormRef = ref(null);
          const loginFormRef = ref(null);
          const registerFormRef = ref(null);
          const passwordFormRef = ref(null);

          // 计算属性
          // 筛选后的商品
          const filteredProducts = computed(() => {
            if (!searchKeyword.value) {
              return products.value;
            }
            return products.value.filter((product) =>
              product.name
                .toLowerCase()
                .includes(searchKeyword.value.toLowerCase())
            );
          });

          // 订单总价
          const totalPrice = computed(() => {
            return orderItems.value.reduce((sum, item) => {
              return sum + item.price * item.quantity;
            }, 0);
          });

          // 筛选后的订单
          const filteredOrders = computed(() => {
            if (orderFilter.value === "全部") {
              return orders.value;
            }
            return orders.value.filter(
              (order) => order.status === orderFilter.value
            );
          });

          // 方法
          // 搜索商品
          const searchProducts = () => {
            if (activePage.value !== "home") {
              activePage.value = "home";
            }
            // 搜索逻辑已在filteredProducts计算属性中实现
          };

          // 查看商品详情
          const viewProductDetail = (productId) => {
            const product = products.value.find((p) => p.id === productId);
            if (product) {
              currentProduct.value = product;
              activePage.value = "product-detail";
            }
          };

          // 创建订单
          const createOrder = () => {
            if (!isLoggedIn.value) {
              ElMessage.warning("请先登录");
              activePage.value = "login";
              return;
            }

            orderItems.value = [
              {
                id: currentProduct.value.id,
                name: currentProduct.value.name,
                price: currentProduct.value.price,
                quantity: 1,
              },
            ];
            activePage.value = "order-confirm";
          };

          // 联系卖家
          const contactSeller = () => {
            ElMessage.success("已向卖家发送消息，请等待回复");
          };

          // 处理用户命令
          const handleUserCommand = (command) => {
            if (command === "profile") {
              activePage.value = "profile";
            } else if (command === "orders") {
              activePage.value = "profile";
              profileMenu.value = "bought-orders";
            } else if (command === "logout") {
              handleLogout();
            }
          };

          // 处理分类选择
          const handleCategorySelect = (index) => {
            console.log("选择分类:", index);
            // 实际应用中这里应该筛选商品
          };

          // 处理图片预览
          const handleImagePreview = (file) => {
            previewImageUrl.value = file.url;
            imagePreviewVisible.value = true;
          };

          // 处理图片移除
          const handleImageRemove = (file, fileList) => {
            publishForm.images = fileList;
          };

          // 处理图片变化
          const handleImageChange = (file, fileList) => {
            publishForm.images = fileList;
          };

          // 提交发布
          const submitPublish = () => {
            if (!publishFormRef.value) return;

            publishFormRef.value.validate((valid) => {
              if (valid) {
                // 模拟API调用
                ElMessage.success("商品发布成功！");
                // 重置表单
                publishFormRef.value.resetFields();
                publishForm.images = [];
                // 跳转到首页
                activePage.value = "home";
              } else {
                ElMessage.error("请正确填写表单");
                return false;
              }
            });
          };

          // 提交订单
          const submitOrder = () => {
            ElMessage.success("订单提交成功，等待卖家确认");
            activePage.value = "profile";
            profileMenu.value = "bought-orders";
          };

          // 处理个人中心菜单选择
          const handleProfileMenuSelect = (index) => {
            profileMenu.value = index;
          };

          // 编辑商品
          const editProduct = (product) => {
            ElMessage.info("编辑商品功能开发中");
          };

          // 切换商品状态
          const toggleProductStatus = (product) => {
            product.status = product.status === "在售" ? "下架" : "在售";
            ElMessage.success(
              `商品已${product.status === "在售" ? "上架" : "下架"}`
            );
          };

          // 删除商品
          const deleteProduct = (product) => {
            ElMessageBox.confirm("确定要删除这个商品吗？", "提示", {
              confirmButtonText: "确定",
              cancelButtonText: "取消",
              type: "warning",
            })
              .then(() => {
                const index = myProducts.value.findIndex(
                  (p) => p.id === product.id
                );
                if (index !== -1) {
                  myProducts.value.splice(index, 1);
                  ElMessage.success("商品删除成功");
                }
              })
              .catch(() => {
                // 用户取消
              });
          };

          // 获取订单状态标签类型
          const getOrderStatusType = (status) => {
            switch (status) {
              case "待确认":
                return "warning";
              case "交易中":
                return "primary";
              case "已完成":
                return "success";
              default:
                return "info";
            }
          };

          // 筛选订单
          const filterOrders = () => {
            // 已在计算属性中实现
          };

          // 显示评价对话框
          const showReviewDialog = (order) => {
            showReviewDialogVisible.value = true;
            // 重置评价表单
            reviewForm.rating = 5;
            reviewForm.content = "";
          };

          // 提交评价
          const submitReview = () => {
            ElMessage.success("评价提交成功，感谢您的反馈");
            showReviewDialogVisible.value = false;
          };

          // 更新用户信息
          const updateUserInfo = () => {
            ElMessage.success("用户信息更新成功");
          };

          // 修改密码
          const changePassword = () => {
            if (!passwordFormRef.value) return;

            passwordFormRef.value.validate((valid) => {
              if (valid) {
                ElMessage.success("密码修改成功，请重新登录");
                showChangePassword.value = false;
                // 清空表单
                passwordForm.oldPassword = "";
                passwordForm.newPassword = "";
                passwordForm.confirmPassword = "";
              }
            });
          };

          // 处理登录
          const handleLogin = () => {
            if (!loginFormRef.value) return;

            loginFormRef.value.validate((valid) => {
              if (valid) {
                // 模拟登录成功
                isLoggedIn.value = true;
                ElMessage.success("登录成功");
                activePage.value = "home";
                // 清空表单
                loginForm.username = "";
                loginForm.password = "";
              }
            });
          };

          // 处理注册
          const handleRegister = () => {
            if (!registerFormRef.value) return;

            registerFormRef.value.validate((valid) => {
              if (valid) {
                // 模拟注册成功
                ElMessage.success("注册成功，请登录");
                activePage.value = "login";
                // 清空表单
                registerForm.username = "";
                registerForm.password = "";
                registerForm.realName = "";
                registerForm.phone = "";
                registerForm.studentId = "";
              }
            });
          };

          // 处理退出登录
          const handleLogout = () => {
            ElMessageBox.confirm("确定要退出登录吗？", "提示", {
              confirmButtonText: "确定",
              cancelButtonText: "取消",
              type: "warning",
            })
              .then(() => {
                isLoggedIn.value = false;
                ElMessage.success("已退出登录");
                activePage.value = "home";
              })
              .catch(() => {
                // 用户取消
              });
          };

          // 显示通知
          const showNotifications = () => {
            ElMessage.info("您有3条未读消息");
          };

          // 初始化数据
          onMounted(() => {
            // 模拟默认登录状态
            // isLoggedIn.value = true;
          });

          return {
            // 数据
            activePage,
            searchKeyword,
            isLoggedIn,
            currentUser,
            categories,
            carouselItems,
            products,
            filteredProducts,
            currentProduct,
            publishForm,
            publishRules,
            orderItems,
            paymentMethod,
            totalPrice,
            profileMenu,
            myProducts,
            orders,
            soldOrders,
            filteredOrders,
            orderFilter,
            userInfoForm,
            passwordForm,
            passwordRules,
            loginForm,
            loginRules,
            registerForm,
            registerRules,
            reviewForm,
            showChangePassword,
            showReviewDialogVisible,
            imagePreviewVisible,
            previewImageUrl,

            // 表单引用
            publishFormRef,
            loginFormRef,
            registerFormRef,
            passwordFormRef,

            // 方法
            searchProducts,
            viewProductDetail,
            createOrder,
            contactSeller,
            handleUserCommand,
            handleCategorySelect,
            handleImagePreview,
            handleImageRemove,
            handleImageChange,
            submitPublish,
            submitOrder,
            handleProfileMenuSelect,
            editProduct,
            toggleProductStatus,
            deleteProduct,
            getOrderStatusType,
            filterOrders,
            showReviewDialog,
            submitReview,
            updateUserInfo,
            changePassword,
            handleLogin,
            handleRegister,
            handleLogout,
            showNotifications,
          };
        },
      })
        .use(ElementPlus)
        .mount("#app");
    </script>
  </body>
</html>
